<!doctype html>
<html class="docs-version-v17" lang="en" dir="ltr">
<head>
<meta charset=UTF-8"UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="GraphQL Java RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="GraphQL Java Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-126627606-1","auto"),ga("send","pageview")</script>
<script async src="../../../../www.google-analytics.com/analytics.js" tppabs="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Batching | GraphQL Java</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://graphql-java.com/documentation/v17/batching"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="v17"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-v17"><meta data-react-helmet="true" property="og:title" content="Batching | GraphQL Java"><meta data-react-helmet="true" name="description" content="How to avoid the dreaded N+1 calls for data and make your graphql system more efficient"><meta data-react-helmet="true" property="og:description" content="How to avoid the dreaded N+1 calls for data and make your graphql system more efficient"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://graphql-java.com/documentation/v17/batching"><link data-react-helmet="true" rel="alternate" href="https://graphql-java.com/documentation/v17/batching" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://graphql-java.com/documentation/v17/batching" hreflang="x-default"><link rel="stylesheet" href="../../../assets/css/styles.cf0d1b68.css" tppabs="https://www.graphql-java.com/assets/css/styles.cf0d1b68.css">
<link rel="preload" href="/assets/js/runtime~main.97858eab.js" as="script">
<link rel="preload" href="/assets/js/main.3a2e843f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="javascript:if(confirm('https://www.graphql-java.com/  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.graphql-java.com/'" tppabs="https://www.graphql-java.com/"><div class="navbar__logo"><img src="../../../img/logo.png" tppabs="https://www.graphql-java.com/img/logo.png" alt="GraphQL Java logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="../../../img/logo.png" tppabs="https://www.graphql-java.com/img/logo.png" alt="GraphQL Java logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">GraphQL Java</b></a><a class="navbar__item navbar__link navbar__link--active" href="../getting-started/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/getting-started">Documentation</a><a href="javascript:if(confirm('https://leanpub.com/graphql-java/  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://leanpub.com/graphql-java/'" tppabs="https://leanpub.com/graphql-java/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Book</a><a class="navbar__item navbar__link" href="javascript:if(confirm('https://www.graphql-java.com/tutorials/getting-started-with-spring-boot  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.graphql-java.com/tutorials/getting-started-with-spring-boot'" tppabs="https://www.graphql-java.com/tutorials/getting-started-with-spring-boot">Tutorial</a><a class="navbar__item navbar__link" href="javascript:if(confirm('https://www.graphql-java.com/blog  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.graphql-java.com/blog'" tppabs="https://www.graphql-java.com/blog">Blog</a><a class="navbar__item navbar__link" href="javascript:if(confirm('https://www.graphql-java.com/about  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.graphql-java.com/about'" tppabs="https://www.graphql-java.com/about">About</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="../getting-started/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/getting-started">v17</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="../../master/batching/index.htm" tppabs="https://www.graphql-java.com/documentation/master/batching">master</a></li><li><a class="dropdown__link" href="../../batching/index.htm" tppabs="https://www.graphql-java.com/documentation/batching">v18</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="index.htm" tppabs="https://www.graphql-java.com/documentation/v17/batching">v17</a></li></ul></div><a href="javascript:if(confirm('https://github.com/graphql-java/graphql-java  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/graphql-java/graphql-java'" tppabs="https://github.com/graphql-java/graphql-java" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../getting-started/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/getting-started">Getting started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="index.htm" tppabs="https://www.graphql-java.com/documentation/v17/batching">Batching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../concerns/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/concerns">Concerns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../contributions/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/contributions">Contributions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../data-fetching/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/data-fetching">Data fetching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../data-mapping/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/data-mapping">Data mapping</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../exceptions/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/exceptions">Exceptions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../execution/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/execution">Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../field-selection/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/field-selection">Field Selection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../field-visibility/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/field-visibility">Field Visibility</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../instrumentation/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/instrumentation">Instrumentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../logging/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/logging">Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../relay/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/relay">Relay</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../scalars/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/scalars">Scalars</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../schema/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/schema">Schema</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../sdl-directives/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/sdl-directives">SDL Directives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../subscriptions/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/subscriptions">Subscriptions</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->GraphQL Java<!-- --> <b>v17</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="../../batching/index.htm" tppabs="https://www.graphql-java.com/documentation/batching">latest version</a></b> (<!-- -->v18<!-- -->).</div></div><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->v17</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Using Dataloader</h1></header><p>If you are using <code>graphql</code>, you are likely to making queries on a graph of data (no surprises there).  However, it&#x27;s easy
to implement inefficient code with naive loading of a graph of data.</p><p>Using <code>java-dataloader</code> will help you to make this a more efficient process by both caching and batching requests for that graph of data items.  If <code>dataloader</code>
has seen a data item before, it will have cached the value and will return it without having to ask for it again.</p><p>Imagine we have the StarWars query outlined below.  It asks us to find a hero, and their friend&#x27;s names, and their friend&#x27;s friend&#x27;s
names.  It is likely that many of these people will be friends in common.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI graphql"><pre tabindex="0" class="prism-code language-graphql codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hero </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        friends </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            friends </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The result of this query is displayed below. You can see that Han, Leia, Luke and R2-D2 are a tight-knit bunch of friends and
share many friends in common.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;hero&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;R2-D2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;friends&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Luke Skywalker&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;friends&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Han Solo&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Leia Organa&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;C-3PO&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;R2-D2&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Han Solo&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;friends&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Luke Skywalker&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Leia Organa&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;R2-D2&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Leia Organa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;friends&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Luke Skywalker&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Han Solo&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;C-3PO&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;R2-D2&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>A naive implementation would call a <code>DataFetcher</code> to retrieve a person object every time it was invoked.</p><p>In this case it would be <em>15</em> calls over the network, even though the group of people have a lot of common friends.
With <code>dataloader</code> you can make the <code>graphql</code> query much more efficient.</p><p>As <code>graphql</code> descends each level of the query (e.g., as it processes <code>hero</code> and then <code>friends</code> and then for each of their <code>friends</code>),
the data loader is called to &quot;promise&quot; to deliver a person object.  At each level <code>dataloader.dispatch()</code> will be
called to fire off the batch requests for that part of the query. With caching turned on (the default) then
any previously returned person will be returned as-is for no cost.</p><p>In the above example there are only <em>5</em> unique people mentioned but with caching and batching retrieval in place there will be only
<em>3</em> calls to the batch loader function.  <em>3</em> calls over the network or to a database is much better than <em>15</em> calls, you will agree.</p><p>If you use capabilities like <code>java.util.concurrent.CompletableFuture.supplyAsync()</code> then you can make it even more efficient by making the
remote calls asynchronous to the rest of the query.  This will make it even more timely since multiple calls can happen at once
if need be.</p><p>Here is how you might put this in place:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// a batch loader function that will be called with N or more keys for batch loading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// This can be a singleton object since it&#x27;s stateless</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BatchLoader&lt;String, Object&gt; characterBatchLoader = new BatchLoader&lt;String, Object&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CompletionStage&lt;List&lt;Object&gt;&gt; load(List&lt;String&gt; keys) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // we use supplyAsync() of values here for maximum parellisation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return CompletableFuture.supplyAsync(() -&gt; getCharacterDataViaBatchHTTPApi(keys));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// use this data loader in the data fetchers associated with characters and put them into</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// the graphql schema (not shown)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataFetcher&lt;?&gt; heroDataFetcher = new DataFetcher&lt;Object&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object get(DataFetchingEnvironment environment) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DataLoader&lt;String, Object&gt; dataLoader = environment.getDataLoader(&quot;character&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return dataLoader.load(&quot;2001&quot;); // R2D2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataFetcher&lt;?&gt; friendsDataFetcher = new DataFetcher&lt;Object&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object get(DataFetchingEnvironment environment) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StarWarsCharacter starWarsCharacter = environment.getSource();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;String&gt; friendIds = starWarsCharacter.getFriendIds();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DataLoader&lt;String, Object&gt; dataLoader = environment.getDataLoader(&quot;character&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return dataLoader.loadMany(friendIds);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// this instrumentation implementation will dispatch all the data loaders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// as each level of the graphql query is executed and hence make batched objects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// available to the query and the associated DataFetchers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// In this case we use options to make it keep statistics on the batching efficiency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataLoaderDispatcherInstrumentationOptions options = DataLoaderDispatcherInstrumentationOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .newOptions().includeStatistics(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataLoaderDispatcherInstrumentation dispatcherInstrumentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        = new DataLoaderDispatcherInstrumentation(options);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// now build your graphql object and execute queries on it.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// the data loader will be invoked via the data fetchers on the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// schema fields</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GraphQL graphQL = GraphQL.newGraphQL(buildSchema())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .instrumentation(dispatcherInstrumentation)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// a data loader for characters that points to the character batch loader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Since data loaders are stateful, they are created per execution request.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataLoader&lt;String, Object&gt; characterDataLoader = DataLoaderFactory.newDataLoader(characterBatchLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// DataLoaderRegistry is a place to register all data loaders in that needs to be dispatched together</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// in this case there is 1 but you can have many.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Also note that the data loaders are created per execution request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataLoaderRegistry registry = new DataLoaderRegistry();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">registry.register(&quot;character&quot;, characterDataLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecutionInput executionInput = newExecutionInput()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .query(getQuery())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .dataLoaderRegistry(registry)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecutionResult executionResult = graphQL.execute(executionInput);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In this example we explicitly added the <code>DataLoaderDispatcherInstrumentation</code> because we wanted to tweak its options.  However,
it will be automatically added for you if you don&#x27;t add it manually.</p><p>You can read a lot more about the <code>java-dataloader</code> API in detail over
at <a href="javascript:if(confirm('https://github.com/graphql-java/java-dataloader  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/graphql-java/java-dataloader#readme'" tppabs="https://github.com/graphql-java/java-dataloader#readme" target="_blank" rel="noopener noreferrer">https://github.com/graphql-java/java-dataloader</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="data-loader-only-works-with-asyncexecutionstrategy">Data Loader only works with AsyncExecutionStrategy<a aria-hidden="true" class="hash-link" href="#data-loader-only-works-with-asyncexecutionstrategy" title="Direct link to heading">â€‹</a></h2><p>The only execution that works with DataLoader is <code>graphql.execution.AsyncExecutionStrategy</code>.  This is because this execution strategy knows
then the most optimal time to dispatch() your load calls is.  It does this by deeply tracking how many fields are outstanding and whether they
are list values and so on.</p><p>Other execution strategies such as <code>ExecutorServiceExecutionStrategy</code> can&#x27;t do this and hence if the data loader code detects
you are not using <code>AsyncExecutionStrategy</code> then it will simply dispatch the data loader as each field is encountered.  You
may get <code>caching</code> of values, but you will not get <code>batching</code> of them.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="per-request-data-loaders">Per Request Data Loaders<a aria-hidden="true" class="hash-link" href="#per-request-data-loaders" title="Direct link to heading">â€‹</a></h2><p>If you are serving web requests then the data can be specific to the user requesting it. If you have user specific data then you will not want to
cache data meant for user A to then later give it to user B in a subsequent request.</p><p>The scope of your DataLoader instances is important. You will want to create them per web request to
ensure data is only cached within that web request and no more. It also ensures that a <code>dispatch</code> call
only affects that graphql execution and no other.</p><p>DataLoaders by default act as caches.  If they have seen a value before for a key then they will automatically return
it in order to be efficient.  They cache promises to a value and optionally the value itself.</p><p>If your data can be shared across web requests then you might want to change the <code>ValueCache</code> implementation of your data loaders, so they share
data via caching systems like memcached or redis.</p><p>You still create data loaders per request, however the caching layer will allow data sharing (if that&#x27;s suitable).</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">ValueCache&lt;String, Object&gt; crossRequestValueCache = new ValueCache&lt;String, Object&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CompletableFuture&lt;Object&gt; get(String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return redisIntegration.getValue(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CompletableFuture&lt;Object&gt; set(String key, Object value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return redisIntegration.setValue(key, value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CompletableFuture&lt;Void&gt; delete(String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return redisIntegration.clearKey(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CompletableFuture&lt;Void&gt; clear() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return redisIntegration.clearAll();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataLoaderOptions options = DataLoaderOptions.newOptions().setValueCache(crossRequestValueCache);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataLoader&lt;String, Object&gt; dataLoader = DataLoaderFactory.newDataLoader(batchLoader, options);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="async-calls-on-your-batch-loader-function-only">Async Calls On Your Batch Loader Function Only<a aria-hidden="true" class="hash-link" href="#async-calls-on-your-batch-loader-function-only" title="Direct link to heading">â€‹</a></h2><p>The data loader code pattern works by combining all the outstanding data loader calls into more efficient batch loading calls.</p><p>graphql-java tracks what outstanding data loader calls have been made, and it is its responsibility to call <code>dispatch</code>
in the background at the most optimal time, which is when all graphql fields have been examined and dispatched.</p><p>However, there is a code pattern that will cause your data loader calls to never complete, and these <em>MUST</em> be avoided.  This bad
pattern consists of making an asynchronous off thread call to a <code>DataLoader</code> in your data fetcher.</p><p>The following will not work (it will never complete).</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">BatchLoader&lt;String, Object&gt; batchLoader = new BatchLoader&lt;String, Object&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CompletionStage&lt;List&lt;Object&gt;&gt; load(List&lt;String&gt; keys) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return CompletableFuture.completedFuture(getTheseCharacters(keys));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataLoader&lt;String, Object&gt; characterDataLoader = DataLoaderFactory.newDataLoader(batchLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// .... later in your data fetcher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataFetcher&lt;?&gt; dataFetcherThatCallsTheDataLoader = new DataFetcher&lt;Object&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object get(DataFetchingEnvironment environment) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Don&#x27;t DO THIS!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return CompletableFuture.supplyAsync(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String argId = environment.getArgument(&quot;id&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            DataLoader&lt;String, Object&gt; characterLoader = environment.getDataLoader(&quot;characterLoader&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return characterLoader.load(argId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the example above, the call to <code>characterDataLoader.load(argId)</code> can happen some time in the future on another thread.  The graphql-java
engine has no way of knowing when it&#x27;s good time to dispatch outstanding <code>DataLoader</code> calls and hence the data loader call might never complete
as expected and no results will be returned.</p><p>Remember a data loader call is just a promise to actually get a value later when it&#x27;s an optimal time for all outstanding calls to be batched
together.  The most optimal time is when the graphql field tree has been examined and all field values are currently dispatched.</p><p>The following is how you can still have asynchronous code, by placing it into the <code>BatchLoader</code> itself.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">BatchLoader&lt;String, Object&gt; batchLoader = new BatchLoader&lt;String, Object&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CompletionStage&lt;List&lt;Object&gt;&gt; load(List&lt;String&gt; keys) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return CompletableFuture.supplyAsync(() -&gt; getTheseCharacters(keys));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataLoader&lt;String, Object&gt; characterDataLoader = DataLoaderFactory.newDataLoader(batchLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// .... later in your data fetcher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataFetcher&lt;?&gt; dataFetcherThatCallsTheDataLoader = new DataFetcher&lt;Object&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object get(DataFetchingEnvironment environment) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // This is OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String argId = environment.getArgument(&quot;id&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DataLoader&lt;String, Object&gt; characterLoader = environment.getDataLoader(&quot;characterLoader&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return characterLoader.load(argId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Notice above the <code>characterDataLoader.load(argId)</code> returns immediately.  This will enqueue the call for data until a later time when all
the graphql fields are dispatched.</p><p>Then later when the <code>DataLoader</code> is dispatched, it&#x27;s <code>BatchLoader</code> function is called.  This code can be asynchronous so that if you have multiple batch loader
functions they all can run at once.  In the code above <code>CompletableFuture.supplyAsync(() -&gt; getTheseCharacters(keys));</code> will run the <code>getTheseCharacters</code>
method in another thread.</p><header><h1>Passing context to your data loader</h1></header><p>The data loader library supports two types of context being passed to the batch loader. The first is
an overall context object per dataloader, and the second is a map of per loaded key context objects.</p><p>This allows you to pass in the extra details you may need to make downstream calls.  The dataloader key is used
in the caching of results, but the context objects can be made available to help with the call.</p><p>So in the example below we have an overall security context object that gives out a call token, and we also pass the graphql source
object to each <code>dataLoader.load()</code> call.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI java"><pre tabindex="0" class="prism-code language-java codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">BatchLoaderWithContext&lt;String, Object&gt; batchLoaderWithCtx = new BatchLoaderWithContext&lt;String, Object&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CompletionStage&lt;List&lt;Object&gt;&gt; load(List&lt;String&gt; keys, BatchLoaderEnvironment loaderContext) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // we can have an overall context object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SecurityContext securityCtx = loaderContext.getContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // and we can have a per key set of context objects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;Object, Object&gt; keysToSourceObjects = loaderContext.getKeyContexts();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return CompletableFuture.supplyAsync(() -&gt; getTheseCharacters(securityCtx.getToken(), keys, keysToSourceObjects));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SecurityContext securityCtx = SecurityContext.newSecurityContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BatchLoaderContextProvider contextProvider = new BatchLoaderContextProvider() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object getContext() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return securityCtx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// this creates an overall context for the dataloader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataLoaderOptions loaderOptions = DataLoaderOptions.newOptions().setBatchLoaderContextProvider(contextProvider);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataLoader&lt;String, Object&gt; characterDataLoader = DataLoaderFactory.newDataLoader(batchLoaderWithCtx, loaderOptions);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// .... later in your data fetcher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DataFetcher&lt;?&gt; dataFetcherThatCallsTheDataLoader = new DataFetcher&lt;Object&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object get(DataFetchingEnvironment environment) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String argId = environment.getArgument(&quot;id&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object source = environment.getSource();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // you can pass per load call contexts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return characterDataLoader.load(argId, source);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="javascript:if(confirm('https://github.com/graphql-java/graphql-java-page/edit/master/versioned_docs/version-v17/batching.md  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/graphql-java/graphql-java-page/edit/master/versioned_docs/version-v17/batching.md'" tppabs="https://github.com/graphql-java/graphql-java-page/edit/master/versioned_docs/version-v17/batching.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="../getting-started/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/getting-started"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Getting started</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="../concerns/index.htm" tppabs="https://www.graphql-java.com/documentation/v17/concerns"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Concerns<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#data-loader-only-works-with-asyncexecutionstrategy" class="table-of-contents__link toc-highlight">Data Loader only works with AsyncExecutionStrategy</a></li><li><a href="#per-request-data-loaders" class="table-of-contents__link toc-highlight">Per Request Data Loaders</a></li><li><a href="#async-calls-on-your-batch-loader-function-only" class="table-of-contents__link toc-highlight">Async Calls On Your Batch Loader Function Only</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="../../getting-started/index.htm" tppabs="https://www.graphql-java.com/documentation/getting-started">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="javascript:if(confirm('https://www.graphql-java.com/tutorials/getting-started-with-spring-boot  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.graphql-java.com/tutorials/getting-started-with-spring-boot'" tppabs="https://www.graphql-java.com/tutorials/getting-started-with-spring-boot">3 Min Tutorial</a></li><li class="footer__item"><a href="javascript:if(confirm('https://javadoc.io/doc/com.graphql-java/graphql-java/  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://javadoc.io/doc/com.graphql-java/graphql-java/'" tppabs="https://javadoc.io/doc/com.graphql-java/graphql-java/" target="_blank" rel="noopener noreferrer" class="footer__link-item">JavaDoc</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="javascript:if(confirm('https://github.com/graphql-java/graphql-java/discussions  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/graphql-java/graphql-java/discussions'" tppabs="https://github.com/graphql-java/graphql-java/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="javascript:if(confirm('https://twitter.com/graphql_java  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://twitter.com/graphql_java'" tppabs="https://twitter.com/graphql_java" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="javascript:if(confirm('https://www.graphql-java.com/blog  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.graphql-java.com/blog'" tppabs="https://www.graphql-java.com/blog">Blog</a></li><li class="footer__item"><a href="javascript:if(confirm('https://github.com/graphql-java/graphql-java  \n\n¸ÃÎÄ¼þÎÞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·þÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/graphql-java/graphql-java'" tppabs="https://github.com/graphql-java/graphql-java" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Andreas Marek.</div></div></div></footer></div>
<script src="../../../assets/js/runtime~main.97858eab.js" tppabs="https://www.graphql-java.com/assets/js/runtime~main.97858eab.js"></script>
<script src="../../../assets/js/main.3a2e843f.js" tppabs="https://www.graphql-java.com/assets/js/main.3a2e843f.js"></script>
</body>
</html>